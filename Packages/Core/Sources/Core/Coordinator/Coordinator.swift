//
//  Coordinator.swift
//  Core
//
//  Created by –õ—é–±—á–µ–Ω–∫–æ –°—Ç–∞–Ω–∏—Å–ª–∞–≤ –í–∞–ª–µ—Ä—å–µ–≤–∏—á on 12.02.2026.
//

import UIKit

/// –ë–∞–∑–æ–≤—ã–π –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞.
///
/// –Ø–≤–ª—è–µ—Ç—Å—è —Å–≤—è–∑—É—é—â–∏–º –∑–≤–µ–Ω–æ–º –º–µ–∂–¥—É –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–†–æ—É—Ç–µ—Ä–æ–º) –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π (–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–º).
/// –£–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø–æ—Ç–æ–∫–∞ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –º–µ—Ç–æ–¥–∞–º –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.
///
/// - Generic Parameter R: –¢–∏–ø —Ä–æ—É—Ç–µ—Ä–∞ (`Routing`), —Å –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä.
///   –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é: –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø
///   —Ç–æ–ª—å–∫–æ –∫ –º–µ—Ç–æ–¥–∞–º `StackRouting`, –Ω–æ –Ω–µ `TabRouting`.
@MainActor
open class Coordinator<R: Routing> {

    /// –†–æ—É—Ç–µ—Ä, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è.
    ///
    /// - Warning: –ù–µ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —ç—Ç–æ–º—É —Å–≤–æ–π—Å—Ç–≤—É –≤ –º–µ—Ç–æ–¥–µ `init`. –í –º–æ–º–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–æ—É—Ç–µ—Ä –µ—â–µ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω.
    ///   –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞ `start()` –∏ –ø–æ—Å–ª–µ –Ω–µ–≥–æ.
    public var router: R? {
        assert(_router != nil, """
        üõë –û–®–ò–ë–ö–ê –î–û–°–¢–£–ü–ê –ö –†–û–£–¢–ï–†–£ (router is nil)
        
        –í—ã –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–≤–æ–π—Å—Ç–≤—É `router`, –Ω–æ –æ–Ω–æ –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ.
        
        –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è:
        1. **–û–±—Ä–∞—â–µ–Ω–∏–µ –≤ init:** –í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞.
           -> –ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ –ª–æ–≥–∏–∫—É –≤ –º–µ—Ç–æ–¥ `start()`.
        2. **–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:** –í—ã –≤—ã–∑–≤–∞–ª–∏ `coordinator.start()` –≤—Ä—É—á–Ω—É—é –∏–∑ –ö–æ–º–ø–æ—É–∑–µ—Ä–∞ –∏–ª–∏ –§–∞–±—Ä–∏–∫–∏.
           -> –≠—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ. –ú–µ—Ç–æ–¥ `start()` –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –†–æ—É—Ç–µ—Ä–∞.
        3. **–û—à–∏–±–∫–∞ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è:** –†–æ—É—Ç–µ—Ä –Ω–µ –ø–µ—Ä–µ–¥–∞–ª —Å—Å—ã–ª–∫—É –Ω–∞ —Å–µ–±—è (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ Core).
        """)
        return _router
    }

    public init() {}

    // MARK: - Internal Infrastructure Logic

    /// –°–ª—É–∂–µ–±–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –†–æ—É—Ç–µ—Ä–∞ –∏ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞.
    ///
    /// –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
    /// 1. **Dependency Injection:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–æ—É—Ç–µ—Ä (`R`), —Å –∫–æ—Ç–æ—Ä—ã–º –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä.
    /// 2. **Lifecycle Management:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç—É —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —Ä–æ—É—Ç–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω).
    /// 3. **Flow Trigger:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ `start()`.
    ///
    /// - Parameter router: –†–æ—É—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫. –û–±—ã—á–Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `self` –∏–∑ `viewDidLoad` –∏–ª–∏ `init` —Ä–æ—É—Ç–µ—Ä–∞.
    ///
    /// - Note: **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ (`internal`):**
    ///   –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –ø–∞–∫–µ—Ç–∞ `Core`. –≠—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∑–∞—â–∏—Ç–∞, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—â–∞—è
    ///   —Ä—É—á–Ω–æ–π –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ –∏–∑ –§–∞–±—Ä–∏–∫, –ö–æ–º–ø–æ—É–∑–µ—Ä–æ–≤ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π.
    ///   –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–∏—á–∏ –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ —Å–≤—è–∑—ã–≤–∞–Ω–∏–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –†–æ—É—Ç–µ—Ä–∞.
    internal func start(with router: R) {
        // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è
        guard _router == nil else { return }

        _router = router
        start()
    }

    // MARK: - Public API (For Override)

    /// –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.
    ///
    /// –í —ç—Ç–æ–º –º–µ—Ç–æ–¥–µ –≤—ã –¥–æ–ª–∂–Ω—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω —Ñ–ª–æ—É –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ `router`.
    ///
    /// - Warning: **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –û–ë–Ø–ó–ê–ù –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –∫–ª–∞—Å—Å–µ-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫–µ.
    ///   –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç `fatalError`.
    ///
    /// - Warning: **–†—É—á–Ω–æ–π –≤—ã–∑–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∑—ã–≤–∞–π—Ç–µ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—Ä—É—á–Ω—É—é –∏–∑–≤–Ω–µ.
    ///   –û–Ω –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∞–º–∏–º –†–æ—É—Ç–µ—Ä–æ–º (–≤ `viewDidLoad` –∏–ª–∏ `init`).
    ///   –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞—á–Ω–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ UI –∏ Router –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ.
    open func start() {
        fatalError("–ú–µ—Ç–æ–¥ start() –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–µ \(String(describing: self))")
    }

    // MARK: - Private members

    private weak var _router: R?
}
